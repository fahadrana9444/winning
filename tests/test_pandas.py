
from winning.pandas_util import using_pandas

if using_pandas:
    import pandas as pd
    from winning.pandas_util import add_skew_normal_ability_to_dataframe
    import numpy as np

    def test_pandas():
        df = pd.DataFrame.from_records([( 0,  0, 2538111, 359005, 0.05347642, 0.10070493, 0,  5.36531324e+00),
                                    ( 1,  1, 3409581, 359005, 0.07840445, 0.0625    , 0,  3.31150750e+00),
                                    ( 2,  2, 3819246, 359005, 0.06438515, 0.04342162, 0,  4.38275355e+00),
                                    ( 3,  3, 3918030, 359005, 0.11929426, 0.13157895, 0,  8.96644205e-01),
                                    ( 4,  4, 6445648, 359005, 0.25561541, 0.14184397, 0, -4.07017362e+00),
                                    ( 5,  5, 7253682, 359005, 0.04656697, 0.0551572 , 1,  6.09217096e+00),
                                    ( 6,  6, 7662326, 359005, 0.10802503, 0.08873114, 0,  1.47559509e+00),
                                    ( 7,  7, 7821483, 359005, 0.27423229, 0.37593985, 0, -4.58405876e+00),
                                    ( 8,  8, 8556771, 359005, 0.06453406, 0.17636684, 1,  4.37122690e+00),
                                    ( 9,  9, 8587406, 359005, 0.0929625 , 0.04448399, 0,  2.34762741e+00),
                                    (10, 10, 8612570, 359005, 0.3112959 , 0.32786885, 0, -5.50559722e+00),
                                    (11, 11, 8659871, 359005, 0.2446232 , 0.21691974, 0, -3.76675358e+00),
                                    (12, 12, 8729667, 359005, 0.28658434, 0.2247191 , 0, -4.89233675e+00),
                                    (13, 13, 7535716, 359005, 0.29875097, 0.06839945, 0, -5.19427295e+00),
                                    (14, 14, 7828354, 359005, 0.10779594, 0.08688097, 0,  1.48885804e+00),
                                    (15, 15, 8536492, 359005, 0.08720067, 0.37878788, 0,  2.72439676e+00),
                                    (16, 16, 8619562, 359005, 0.23639059, 0.23640662, 1, -3.53225559e+00),
                                    (17, 17, 8782045, 359005, 0.05593858, 0.00974849, 0,  5.14294432e+00),
                                    (18, 18, 8821235, 359005, 0.07596882, 0.0736377 , 0,  3.48611432e+00),
                                    (19, 19, 9045356, 359005, 0.13795443, 0.13888889, 0,  8.84023342e-03),
                                    (20, 20, 4417089, 359005, 0.78657452, 0.69444444, 0, -1.32599941e+01),
                                    (21, 21, 5036342, 359005, 0.07009541, 0.03617945, 0,  3.94074830e+00),
                                    (22, 22, 7135207, 359005, 0.14333008, 0.27855153, 1, -2.29298260e-01)],
                                   columns=['ndx1' ,'ndx2' ,'product_id' ,'survey_id' ,'p1' ,'p2' ,'y' ,'a_check'])

        df = add_skew_normal_ability_to_dataframe(df=df ,by='survey_id' ,prob_col='p1' ,new_col='a')
        assert np.allclose(df['a'].values,df['a_check'].values, atol=0.001)


if __name__=='__main__':
    if using_pandas:
        test_pandas()